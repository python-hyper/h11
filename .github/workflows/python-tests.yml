name: Test suite

on:
  push:
  pull_request:
  schedule:
  - cron: 1 0 * * *  # Run daily at 0:01 UTC

jobs:
  tests:
    name: ðŸ‘·
    runs-on: ${{ matrix.os }}
    strategy:
      # fail-fast: false
      # max-parallel: 5
      matrix:
        python-version:
        - 3.8
        - 3.7
        - 3.6
        - 3.5
        - 2.7
        os:
        - ubuntu-latest
        - ubuntu-16.04
        - macOS-latest
        - windows-latest
        - windows-2016

    steps:
    - uses: actions/checkout@master
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v1
      with:
        version: ${{ matrix.python-version }}
    - name: Upgrade packaging-related dists
      run: >-
        python -m
        pip install
        --upgrade
        pip
        setuptools
        wheel
    - name: Install test dependencies
      run: >-
        python -m
        pip install
        --upgrade
        -r test-requirements.txt
    - name: Run tests
      run: >-
        pytest
        --cov h11
        --cov-config .coveragerc
        --cov-report term-missing:skip-covered
        --cov-report xml
        h11
    - name: Report collected coverage to Codecov
      uses: codecov/codecov-action@v1
      with:
        file: ./coverage.xml
        flags: unittests
        name: codecov-umbrella
        fail_ci_if_error: true
